<header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1">水合节点不匹配</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/reference/errors/NG0500.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    <p>此错误意味着在水合过程中，Angular 期望的 DOM 结构与服务器端渲染期间渲染和注解的 DOM 结构一致。然而，在客户端，DOM 树与服务器渲染的 DOM 树不同。</p>
<p>此错误通常是由于使用原生浏览器 API 直接操纵 DOM，从而在 Angular 生成的 DOM 结构之外更改了 DOM 结构而发生的。如果您使用 <code>innerHTML</code> 或 <code>outerHTML</code> 设置 HTML 内容（同样会在 Angular 生成的 DOM 结构之外更改 DOM 结构），也会发生此错误。您可以通过重构组件以使用原生 Angular API 而不是原生 API 来解决此问题。如果无法做到这一点，您可以将 <code>ngSkipHydration</code> 属性添加到组件的宿主节点，这将禁用该组件及其子组件的水合。<code>ngSkipHydration</code> 应该只作为最后的手段使用，并且应该被视为需要修复的错误。</p>
<p>有关水合的更多信息，请参见<a href="guide/hydration">本指南</a>。</p>
<p>以下范例将触发此错误。</p>
<div class="docs-code">
    
    <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"><a href="/api/core/Component">Component</a></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">({</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  selector: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'app-example'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  template: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'&lt;div&gt;&lt;span&gt;world&lt;/span&gt;&lt;/div&gt;'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">})</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> ExampleComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70">  hostElement</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> inject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(<a href="/api/core/ElementRef">ElementRef</a>).nativeElement;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">  ngOnInit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">() {</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Create a new &lt;p&gt; element with the `Hello` text inside</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> newNode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">createElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'p'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    newNode.innerHTML </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> 'Hello'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Insert the &lt;p&gt; before the first element. Since Angular has no information</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">   // about the &lt;p&gt; element, it will be looking for the &lt;div&gt; element at the first</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">   // element position instead. As a result, a hydration mismatch error would be</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">   // thrown. Instead, update component's template to create the &lt;p&gt; element.</span></span><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">   this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.hostElement.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">insertBefore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(newNode, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.hostElement.firstChild);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre>
  </div>
  <h2 id="debugging-the-error">
    <a href="#debugging-the-error" class="docs-anchor" tabindex="-1" aria-label="Link to Debugging the error">调试错误</a>
  </h2>
  <p>开发者控制台中的错误消息应包含有关导致问题的应用 DOM 结构的特定部分的信息。检查应用的那部分是否存在与水合相关的错误，例如使用原生 API 进行直接 DOM 操纵。</p>
<p>检查您的模板是否具有有效的 HTML 结构。有关更多信息，请参见<a href="guide/hydration#valid-html-structure">水合指南</a>。</p>
<p>您可以将 <code>ngSkipHydration</code> 属性添加到组件宿主节点，作为一种可能的权宜之计。</p>
<p>如果您的应用在开发环境中工作正常，但在生产构建中看到水合错误，请确保传递到浏览器的生成的 HTML 包含 Angular 在服务器端渲染期间生成的注释节点。这些注释节点被 Angular 运行时用作视图容器（无论是否进行水合）的锚点，并且水合过程期望它们出现在其原始位置。如果您有自定义逻辑从服务器端渲染生成的 HTML 中删除注释节点，或者您已配置 CDN 以在提供内容服务之前删除它们 - 请禁用注释节点移除，并检查水合错误是否消失。</p>
