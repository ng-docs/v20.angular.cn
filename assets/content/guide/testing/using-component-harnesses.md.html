
    <header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1">Using component harnesses in tests</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/guide/testing/using-component-harnesses.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    
  <h2 id="before-you-start">
    <a href="#before-you-start" class="docs-anchor" tabindex="-1" aria-label="Link to Before you start">Before you start</a>
  </h2>
  
    <div class="docs-alert docs-alert-tip">
    <p><strong>TIP:</strong> This guide assumes you've already read the <a href="guide/testing/component-harnesses-overview">component harnesses overview guide</a>. Read that first if you're new to using component harnesses.</p>

    </div>
    
  <h3 id="cdk-installation">
    <a href="#cdk-installation" class="docs-anchor" tabindex="-1" aria-label="Link to CDK Installation">CDK Installation</a>
  </h3>
  <p>The <a href="https://material.angular.dev/cdk/categories" target="_blank">Component Dev Kit (CDK)</a> is a set of behavior primitives for building components. To use the component harnesses, first install <code>@angular/cdk</code> from npm. You can do this from your terminal using the Angular CLI:</p>
<div class="docs-code shell">
    
    <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ng</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> @angular/cdk</span></span></code></pre>
  </div>
  <h2 id="test-harness-environments-and-loaders">
    <a href="#test-harness-environments-and-loaders" class="docs-anchor" tabindex="-1" aria-label="Link to Test harness environments and loaders">Test harness environments and loaders</a>
  </h2>
  <p>You can use component test harnesses in different test environments. Angular CDK supports two built-in environments:</p>

  <ul class="docs-list">
    <li>Unit tests with Angular's <a href="/api/core/testing/TestBed"><code>TestBed</code></a></li>
<li>End-to-end tests with <a href="https://developer.mozilla.org/en-US/docs/Web/WebDriver" target="_blank">WebDriver</a></li>

  </ul>
  <p>Each environment provides a <strong>harness loader</strong>. The loader creates the harness instances you use throughout your tests. See below for more specific guidance on supported testing environments.</p>
<p>Additional testing environments require custom bindings. See the <a href="guide/testing/component-harnesses-testing-environments">adding harness support for additional testing environments guide</a> for more information.</p>

  <h3 id="using-the-loader-from-testbedharnessenvironment-for-unit-tests">
    <a href="#using-the-loader-from-testbedharnessenvironment-for-unit-tests" class="docs-anchor" tabindex="-1" aria-label="Link to Using the loader from <code>TestbedHarnessEnvironment</code> for unit tests">Using the loader from <code>TestbedHarnessEnvironment</code> for unit tests</a>
  </h3>
  <p>For unit tests you can create a harness loader from <a href="/api/cdk/testing/TestbedHarnessEnvironment">TestbedHarnessEnvironment</a>. This environment uses a <a href="api/core/testing/ComponentFixture">component fixture</a> created by Angular's <a href="/api/core/testing/TestBed"><code>TestBed</code></a>.</p>
<p>To create a harness loader rooted at the fixture's root element, use the <code>loader()</code> method:</p>
<div class="docs-code">
    
    <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> fixture</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> <a href="/api/core/testing/TestBed">TestBed</a>.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"><a href="/api/core/createComponent">createComponent</a></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyComponent);</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Create a harness loader from the fixture</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> loader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> <a href="/api/cdk/testing/testbed/TestbedHarnessEnvironment">TestbedHarnessEnvironment</a>.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">loader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(fixture);</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">...</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Use the loader to get harness instances</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> myComponentHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyComponent);</span></span></code></pre>
  </div><p>To create a harness loader for harnesses for elements that fall outside the fixture, use the <code>documentRootLoader()</code> method. For example, code that displays a floating element or pop-up often attaches DOM elements directly to the document body, such as the <code>Overlay</code> service in Angular CDK.</p>
<p>You can also create a harness loader directly with <code>harnessForFixture()</code> for a harness at that fixture's root element directly.</p>

  <h3 id="using-the-loader-from-seleniumwebdriverharnessenvironment-for-end-to-end-tests">
    <a href="#using-the-loader-from-seleniumwebdriverharnessenvironment-for-end-to-end-tests" class="docs-anchor" tabindex="-1" aria-label="Link to Using the loader from <code>SeleniumWebDriverHarnessEnvironment</code> for end-to-end tests">Using the loader from <code>SeleniumWebDriverHarnessEnvironment</code> for end-to-end tests</a>
  </h3>
  <p>For WebDriver-based end-to-end tests you can create a harness loader with <a href="/api/cdk/testing/selenium-webdriver/SeleniumWebDriverHarnessEnvironment"><code>SeleniumWebDriverHarnessEnvironment</code></a>.</p>
<p>Use the <code>loader()</code> method to get the harness loader instance for the current HTML document, rooted at the document's root element. This environment uses a WebDriver client.</p>
<div class="docs-code">
    
    <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> webdriver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">WebDriver</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> getMyWebDriverClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">();</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> loader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> <a href="/api/cdk/testing/selenium-webdriver/SeleniumWebDriverHarnessEnvironment">SeleniumWebDriverHarnessEnvironment</a>.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">loader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(wd);</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">...</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> myComponentHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyComponent);</span></span></code></pre>
  </div>
  <h2 id="using-a-harness-loader">
    <a href="#using-a-harness-loader" class="docs-anchor" tabindex="-1" aria-label="Link to Using a harness loader">Using a harness loader</a>
  </h2>
  <p>Harness loader instances correspond to a specific DOM element and are used to create component harness instances for elements under that specific element.</p>
<p>To get <a href="/api/cdk/testing/ComponentHarness"><code>ComponentHarness</code></a> for the first instance of the element, use the <code>getHarness()</code> method. To get all <a href="/api/cdk/testing/ComponentHarness"><code>ComponentHarness</code></a> instances, use the <code>getAllHarnesses()</code> method.</p>
<div class="docs-code">
    
    <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Get harness for first instance of the element</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> myComponentHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyComponent);</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Get harnesses for all instances of the element</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> myComponentHarnesses</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarnesses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyComponent);</span></span></code></pre>
  </div><p>In addition to <code>getHarness</code> and <code>getAllHarnesses</code>, <a href="/api/cdk/testing/HarnessLoader"><code>HarnessLoader</code></a> has several other useful methods for querying for harnesses:</p>

  <ul class="docs-list">
    <li><code>getHarnessAtIndex(...)</code>: Gets the harness for a component that matches the given criteria at a specific index.</li>
<li><code>countHarnesses(...)</code>: Counts the number of component instances that match the given criteria.</li>
<li><code>hasHarness(...)</code>: Checks if at least one component instance matches the given criteria.</li>

  </ul>
  <p>As an example, consider a reusable dialog-button component that opens a dialog on click. It contains the following components, each with a corresponding harness:</p>

  <ul class="docs-list">
    <li><code>MyDialogButton</code> (composes the <code>MyButton</code> and <code>MyDialog</code> with a convenient API)</li>
<li><code>MyButton</code> (a standard button component)</li>
<li><code>MyDialog</code> (a dialog appended to <code>document.body</code> by <code>MyDialogButton</code> upon click)</li>

  </ul>
  <p>The following test loads harnesses for each of these components:</p>
<div class="docs-code">
    
    <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fixture</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> <a href="/api/core/testing/ComponentFixture">ComponentFixture</a></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">MyDialogButton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;;</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> <a href="/api/cdk/testing/HarnessLoader">HarnessLoader</a></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> rootLoader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> <a href="/api/cdk/testing/HarnessLoader">HarnessLoader</a></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">beforeEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  fixture </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> <a href="/api/core/testing/TestBed">TestBed</a>.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"><a href="/api/core/createComponent">createComponent</a></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyDialogButton);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  loader </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> <a href="/api/cdk/testing/testbed/TestbedHarnessEnvironment">TestbedHarnessEnvironment</a>.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">loader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(fixture);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  rootLoader </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> <a href="/api/cdk/testing/testbed/TestbedHarnessEnvironment">TestbedHarnessEnvironment</a>.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">documentRootLoader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(fixture);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">});</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'loads harnesses'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  // Load a harness for the bootstrapped component with `harnessForFixture`</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  dialogButtonHarness </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> <a href="/api/cdk/testing/testbed/TestbedHarnessEnvironment">TestbedHarnessEnvironment</a>.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">harnessForFixture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(fixture, MyDialogButtonHarness);</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  // The button element is inside the fixture's root element, so we use `loader`.</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> buttonHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyButtonHarness);</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  // Click the button to open the dialog</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> buttonHarness.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">click</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">();</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  // The dialog is appended to `document.body`, outside of the fixture's root element,</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  // so we use `rootLoader` in this case.</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> dialogHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> rootLoader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyDialogHarness);</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  // ... make some assertions</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">});</span></span></code></pre>
  </div>
  <h3 id="harness-behavior-in-different-environments">
    <a href="#harness-behavior-in-different-environments" class="docs-anchor" tabindex="-1" aria-label="Link to Harness behavior in different environments">Harness behavior in different environments</a>
  </h3>
  <p>Harnesses may not behave exactly the same in all environments. Some differences are unavoidable between the real user interaction versus the simulated events generated in unit tests. Angular CDK makes a best effort to normalize the behavior to the extent possible.</p>

  <h3 id="interacting-with-child-elements">
    <a href="#interacting-with-child-elements" class="docs-anchor" tabindex="-1" aria-label="Link to Interacting with child elements">Interacting with child elements</a>
  </h3>
  <p>To interact with elements below the root element of this harness loader, use the <a href="/api/cdk/testing/HarnessLoader"><code>HarnessLoader</code></a> instance of a child element. For the first instance of the child element, use the <code>getChildLoader()</code> method. For all instances of the child element, use the <code>getAllChildLoaders()</code> method.</p>
<div class="docs-code">
    
    <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> myComponentHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyComponent);</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Get loader for first instance of child element with '.child' selector</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> childLoader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> myComponentHarness.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getLoader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'.child'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Get loaders for all instances of child elements with '.child' selector</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> allChildLoaders</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> myComponentHarness.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getAllChildLoaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'.child'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span></code></pre>
  </div>
  <h3 id="filtering-harnesses">
    <a href="#filtering-harnesses" class="docs-anchor" tabindex="-1" aria-label="Link to Filtering harnesses">Filtering harnesses</a>
  </h3>
  <p>When a page contains multiple instances of a particular component, you may want to filter based on some property of the component to get a particular component instance. You can use a <strong>harness predicate</strong>, a class used to associate a <a href="/api/cdk/testing/ComponentHarness"><code>ComponentHarness</code></a> class with predicates functions that can be used to filter component instances, to do so.</p>
<p>When you ask a <a href="/api/cdk/testing/HarnessLoader"><code>HarnessLoader</code></a> for a harness, you're actually providing a HarnessQuery. A query can be one of two things:</p>

  <ul class="docs-list">
    <li>A harness constructor. This just gets that harness</li>
<li>A <a href="/api/cdk/testing/HarnessPredicate"><code>HarnessPredicate</code></a>, which gets harnesses that are filtered based on one or more conditions</li>

  </ul>
  <p><a href="/api/cdk/testing/HarnessPredicate"><code>HarnessPredicate</code></a> does support some base filters (selector, ancestor) that work on anything that extends <a href="/api/cdk/testing/ComponentHarness"><code>ComponentHarness</code></a>.</p>
<div class="docs-code">
    
    <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Example of loading a MyButtonComponentHarness with a harness predicate</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> disabledButtonPredicate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> <a href="/api/cdk/testing/HarnessPredicate">HarnessPredicate</a></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyButtonComponentHarness, {selector: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'[disabled]'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">});</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> disabledButton</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(disabledButtonPredicate);</span></span></code></pre>
  </div><p>However it's common for harnesses to implement a static <code>with()</code> method that accepts component-specific filtering options and returns a <a href="/api/cdk/testing/HarnessPredicate"><code>HarnessPredicate</code></a>.</p>
<div class="docs-code">
    
    <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Example of loading a MyButtonComponentHarness with a specific selector</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> button</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyButtonComponentHarness.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">({selector: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'btn'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}))</span></span></code></pre>
  </div><p>For more details refer to the specific harness documentation since additional filtering options are specific to each harness implementation.</p>

  <h2 id="using-test-harness-apis">
    <a href="#using-test-harness-apis" class="docs-anchor" tabindex="-1" aria-label="Link to Using test harness APIs">Using test harness APIs</a>
  </h2>
  <p>While every harness defines an API specific to its corresponding component, they all share a common base class, <a href="/api/cdk/testing/ComponentHarness">ComponentHarness</a>. This base class defines a static property, <code>hostSelector</code>, that matches the harness class to instances of the component in the DOM.</p>
<p>Beyond that, the API of any given harness is specific to its corresponding component; refer to the component's documentation to learn how to use a specific harness.</p>
<p>As an example, the following is a test for a component that uses the <a href="https://material.angular.dev/components/slider/api#MatSliderHarness" target="_blank">Angular Material slider component harness</a>:</p>
<div class="docs-code">
    
    <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'should get value of slider thumb'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> slider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MatSliderHarness);</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> thumb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> slider.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getEndThumb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">();</span></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">  expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> thumb.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">});</span></span></code></pre>
  </div>
  <h2 id="interop-with-angular-change-detection">
    <a href="#interop-with-angular-change-detection" class="docs-anchor" tabindex="-1" aria-label="Link to Interop with Angular change detection">Interop with Angular change detection</a>
  </h2>
  <p>By default, test harnesses runs Angular's <a href="https://angular.dev/best-practices/runtime-performance" target="_blank">change detection</a> before reading the state of a DOM element and after interacting with a DOM element.</p>
<p>There may be times that you need finer-grained control over change detection in your tests. such as checking the state of a component while an async operation is pending. In these cases use the <a href="/api/cdk/testing/manualChangeDetection"><code>manualChangeDetection</code></a> function to disable automatic handling of change detection for a block of code.</p>
<div class="docs-code">
    
    <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'checks state while async action is in progress'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> buttonHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyButtonHarness);</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> <a href="/api/cdk/testing/manualChangeDetection">manualChangeDetection</a></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> buttonHarness.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">click</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">();</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    fixture.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">detectChanges</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">();</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Check expectations while async click operation is in progress.</span></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">isProgressSpinnerVisible</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fixture.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">whenStable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">();</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Check expectations after async click operation complete.</span></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">isProgressSpinnerVisible</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  });</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">});</span></span></code></pre>
  </div><p>Almost all harness methods are asynchronous and return a <code>Promise</code> to support the following:</p>

  <ul class="docs-list">
    <li>Support for unit tests</li>
<li>Support for end-to-end tests</li>
<li>Insulate tests against changes in asynchronous behavior</li>

  </ul>
  <p>The Angular team recommends using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank">await</a> to improve the test readability. Calling <code>await</code> blocks the execution of your test until the associated <code>Promise</code> resolves.</p>
<p>Occasionally, you may want to perform multiple actions simultaneously and wait until they're all done rather than performing each action sequentially. For example, read multiple properties of a single component. In these situations use the <a href="/api/cdk/testing/parallel"><code>parallel</code></a> function to parallelize the operations. The parallel function works similarly to <code>Promise.all</code>, while also optimizing change detection checks.</p>
<div class="docs-code">
    
    <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'reads properties in parallel'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> checkboxHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyCheckboxHarness);</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  // Read the checked and intermediate properties simultaneously.</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">checked</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">indeterminate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> <a href="/api/cdk/testing/parallel">parallel</a></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> [</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    checkboxHarness.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">isChecked</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(),</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    checkboxHarness.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">isIndeterminate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  ]);</span></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">  expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(checked).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">  expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(indeterminate).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">});</span></span></code></pre>
  </div>