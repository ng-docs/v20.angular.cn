
    <header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1">Adding harness support for additional testing environments</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/guide/testing/component-harnesses-testing-environments.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    
  <h2 id="before-you-start">
    <a href="#before-you-start" class="docs-anchor" tabindex="-1" aria-label="Link to Before you start">Before you start</a>
  </h2>
  
    <div class="docs-alert docs-alert-tip">
    <p><strong>TIP:</strong> This guide assumes you've already read the <a href="guide/testing/component-harnesses-overview">component harnesses overview guide</a>. Read that first if you're new to using component harnesses.</p>

    </div>
    
  <h3 id="when-does-adding-support-for-a-test-environment-make-sense">
    <a href="#when-does-adding-support-for-a-test-environment-make-sense" class="docs-anchor" tabindex="-1" aria-label="Link to When does adding support for a test environment make sense?">When does adding support for a test environment make sense?</a>
  </h3>
  <p>To use component harnesses in the following environments, you can use Angular CDK's two built-in environments:</p>

  <ul class="docs-list">
    <li>Unit tests</li>
<li>WebDriver end-to-end tests</li>

  </ul>
  <p>To use a supported testing environment, read the <a href="guide/testing/creating-component-harnesses">Creating harnesses for your components guide</a>.</p>
<p>Otherwise, to add support for other environments, you need to define how to interact with a DOM element and how DOM interactions work in your environment. Continue reading to learn more.</p>

  <h3 id="cdk-installation">
    <a href="#cdk-installation" class="docs-anchor" tabindex="-1" aria-label="Link to CDK Installation">CDK Installation</a>
  </h3>
  <p>The <a href="https://material.angular.dev/cdk/categories" target="_blank">Component Dev Kit (CDK)</a> is a set of behavior primitives for building components. To use the component harnesses, first install <code>@angular/cdk</code> from npm. You can do this from your terminal using the Angular CLI:</p>
<div class="docs-code shell">
    
    <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ng</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> @angular/cdk</span></span></code></pre>
  </div>
  <h2 id="creating-a-testelement-implementation">
    <a href="#creating-a-testelement-implementation" class="docs-anchor" tabindex="-1" aria-label="Link to Creating a <code>TestElement</code> implementation">Creating a <code>TestElement</code> implementation</a>
  </h2>
  <p>Every test environment must define a <a href="/api/cdk/testing/TestElement"><code>TestElement</code></a> implementation. The <a href="/api/cdk/testing/TestElement"><code>TestElement</code></a> interface serves as an environment-agnostic representation of a DOM element. It enables harnesses to interact with DOM elements regardless of the underlying environment. Because some environments don't support interacting with DOM elements synchronously (e.g. WebDriver), all <a href="/api/cdk/testing/TestElement"><code>TestElement</code></a> methods are asynchronous, returning a <code>Promise</code> with the result of the operation.</p>
<p><a href="/api/cdk/testing/TestElement"><code>TestElement</code></a> offers a number of methods to interact with the underlying DOM such as <code>blur()</code>, <code>click()</code>, <code>getAttribute()</code>, and more. See the <a href="/api/cdk/testing/TestElement">TestElement API reference page</a> for the full list of methods.</p>
<p>The <a href="/api/cdk/testing/TestElement"><code>TestElement</code></a> interface consists largely of methods that resemble methods available on <code>HTMLElement</code>. Similar methods exist in most test environments, which makes implementing the methods fairly straightforward. However, one important difference to note when implementing the <code>sendKeys</code> method, is that the key codes in the <a href="/api/cdk/testing/TestKey"><code>TestKey</code></a> enum likely differ from the key codes used in the test environment. Environment authors should maintain a mapping from <a href="/api/cdk/testing/TestKey"><code>TestKey</code></a> codes to the codes used in the particular testing environment.</p>
<p>The <a href="/api/cdk/testing/testbed/UnitTestElement">UnitTestElement</a> and <a href="/api/cdk/testing/selenium-webdriver/SeleniumWebDriverElement">SeleniumWebDriverElement</a> implementations in Angular CDK serve as good examples of implementations of this interface.</p>

  <h2 id="creating-a-harnessenvironment-implementation">
    <a href="#creating-a-harnessenvironment-implementation" class="docs-anchor" tabindex="-1" aria-label="Link to Creating a <code>HarnessEnvironment</code> implementation">Creating a <code>HarnessEnvironment</code> implementation</a>
  </h2>
  <p>Test authors use <a href="/api/cdk/testing/HarnessEnvironment"><code>HarnessEnvironment</code></a> to create component harness instances for use in tests. <a href="/api/cdk/testing/HarnessEnvironment"><code>HarnessEnvironment</code></a> is an abstract class that must be extended to create a concrete subclass for the new environment. When supporting a new test environment, create a <a href="/api/cdk/testing/HarnessEnvironment"><code>HarnessEnvironment</code></a> subclass that adds concrete implementations for all abstract members.</p>
<p><a href="/api/cdk/testing/HarnessEnvironment"><code>HarnessEnvironment</code></a> has a generic type parameter: <code>HarnessEnvironment&lt;E&gt;</code>. This parameter, <code>E</code>, represents the raw element type of the environment. For example, this parameter is Element for unit test environments.</p>
<p>The following are the abstract methods that must be implemented:</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left">Method</th>
<th align="left">Description</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left"><code>abstract getDocumentRoot(): E</code></td>
<td align="left">Gets the root element for the environment (e.g. <code>document.body</code>).</td>
</tr>
<tr>
<td align="left"><code>abstract createTestElement(element: E): TestElement</code></td>
<td align="left">Creates a <a href="/api/cdk/testing/TestElement"><code>TestElement</code></a> for the given raw element.</td>
</tr>
<tr>
<td align="left"><code>abstract createEnvironment(element: E): HarnessEnvironment</code></td>
<td align="left">Creates a <a href="/api/cdk/testing/HarnessEnvironment"><code>HarnessEnvironment</code></a> rooted at the given raw element.</td>
</tr>
<tr>
<td align="left"><code>abstract getAllRawElements(selector: string): Promise&lt;E[]&gt;</code></td>
<td align="left">Gets all of the raw elements under the root element of the environment matching the given selector.</td>
</tr>
<tr>
<td align="left"><code>abstract forceStabilize(): Promise&lt;void&gt;</code></td>
<td align="left">Gets a <code>Promise</code> that resolves when the <a href="/api/core/NgZone"><code>NgZone</code></a> is stable. Additionally, if applicable, tells <a href="/api/core/NgZone"><code>NgZone</code></a> to stabilize (e.g. calling <a href="/api/core/testing/flush"><code>flush()</code></a> in a <a href="/api/core/testing/fakeAsync"><code>fakeAsync</code></a> test).</td>
</tr>
<tr>
<td align="left"><code>abstract waitForTasksOutsideAngular(): Promise&lt;void&gt;</code></td>
<td align="left">Gets a <code>Promise</code> that resolves when the parent zone of <a href="/api/core/NgZone"><code>NgZone</code></a> is stable.</td>
</tr>

      </tbody>
    </table>
  </div>
  <p>In addition to implementing the missing methods, this class should provide a way for test authors to get <a href="/api/cdk/testing/ComponentHarness"><code>ComponentHarness</code></a> instances. You should define a protected constructor and provide a static method called <code>loader</code> that returns a <a href="/api/cdk/testing/HarnessLoader"><code>HarnessLoader</code></a> instance. This allows test authors to write code like: <code>SomeHarnessEnvironment.loader().getHarness(...)</code>. Depending on the needs of the particular environment, the class may provide several different static methods or require arguments to be passed. (e.g. the <code>loader</code> method on <a href="/api/cdk/testing/testbed/TestbedHarnessEnvironment"><code>TestbedHarnessEnvironment</code></a> takes a <a href="/api/core/testing/ComponentFixture"><code>ComponentFixture</code></a>, and the class provides additional static methods called <code>documentRootLoader</code> and <code>harnessForFixture</code>).</p>
<p>The <a href="/api/cdk/testing/testbed/TestbedHarnessEnvironment"><a href="/api/cdk/testing/testbed/TestbedHarnessEnvironment"><code>TestbedHarnessEnvironment</code></a></a> and <a href="/api/cdk/testing/selenium-webdriver/SeleniumWebDriverHarnessEnvironment">SeleniumWebDriverHarnessEnvironment</a> implementations in Angular CDK serve as good examples of implementations of this interface.</p>

  <h2 id="handling-auto-change-detection">
    <a href="#handling-auto-change-detection" class="docs-anchor" tabindex="-1" aria-label="Link to Handling auto change detection">Handling auto change detection</a>
  </h2>
  <p>In order to support the <a href="/api/cdk/testing/manualChangeDetection"><code>manualChangeDetection</code></a> and parallel APIs, your environment should install a handler for the auto change detection status.</p>
<p>When your environment wants to start handling the auto change detection status it can call <code>handleAutoChangeDetectionStatus(handler)</code>. The handler function will receive a <a href="/api/cdk/testing/AutoChangeDetectionStatus"><code>AutoChangeDetectionStatus</code></a> which has two properties <code>isDisabled</code> and <code>onDetectChangesNow()</code>. See the <a href="/api/cdk/testing/AutoChangeDetectionStatus">AutoChangeDetectionStatus API reference page</a> for more information.
If your environment wants to stop handling auto change detection status it can call <a href="/api/cdk/testing/stopHandlingAutoChangeDetectionStatus"><code>stopHandlingAutoChangeDetectionStatus()</code></a>.</p>
